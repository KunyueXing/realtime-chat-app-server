# realtime-chat-app-server
## Summary

## Outline
* Key Features
* Tech Stack / Dependencies
* Architecture Overview
* Data Models
* API Reference
* Socket.IO Events
* Installation & Setup
* Deployment
* Usage
  * API testing instructions (e.g. via Postman)
  * How to test chat messages
* Security Notes
  * JWT authentication
  * HTTPS usage
* Known Issues / Limitations
  * Features under development
  * Current Issues
* Acknowledgements

## Key Features
* User authentication and authorization
* Real-time 1:1 messaging
* Group chat with admin roles
* AI assistant via OpenAI
* Audio/video call support
* Message starring
* Media uploads via AWS S3

## Tech Stack / Dependencies
* Runtime & Framework: Node.js, Express.js
* Database:
  * MongoDB (Compass for GUI) - NoSQL database to store user profiles, chats, messages, and other structured data
  * Mongoose - Object Data Modeling (ODM) for MongoDB
  * AWS S3 - file storage
* Real-time Communication: Socket.IO
* Authentication & Authorization:
  * jsonwebtoken (JWT) – Secure token-based user authentication
  * cookie-parser & cookie-session – Parse and manage cookies for session handling
  * bcryptjs – Password hashing and verification
  * otp-generator – Generate OTPs for verification flows (e.g., email/phone verification)
* Email Service:
  * SendGrid – Transactional email delivery for signup verification, password reset, etc.
* Environment & Utilities:
	 * dotenv – Manage environment variables
  * cors – Enable/disable cross-origin requests
  * morgan – HTTP request logger middleware for debugging and monitoring
  * nodemon – Auto-restarts server during development
* Audio / Video Services
* optional: Docker, AWS EC2, Kubernetes

## Architecture Overview

## Data Models
This project uses **MongoDB** for storing users, groups, messages, and other structured data, and **AWS S3** for storing images, files, and attachments. Below are the main data models used in the backend. 
#### 1 User
```js
{
  _id: ObjectId,                   // Generated by MongoDB when the user is created
  firstName: String,               // Required
  lastName: String,                // Required
  username: String,                // Unique, for display
  email: String,                   // Required, Unique, valid address
  password: String,                // Required, minLength: 6
  passwordConfirm: String,         // Required when register, select: false -- not stored in the database
  passwordChangedAt: Date,
  passwordResetToken: String,
  passwordResetExpires: String,
  otp: String,                     // For verification
  otpExpiryTime: Date,
  avatarUrl: String,               // S3 URL for user avatar
  about: String,
  friends: [ObjectId],             // Ref: User _ids
  groups: [ObjectId],              // Ref: Group _ids
  emailVerified: Boolean,          // Default: false
  createdAt: Date,                 // Default: Date.now()
  updatedAt: Date,
  status: "online" | "offline",
  socketId: String,
  chats: [ObjectId],               // Ref: Chat _ids
  notifications: [ObjectId],       // Ref: Notification _ids
  invitationRequests: [ObjectId],  // Ref: Invitation Request _ids
  collections: [ObjectId]          // Ref: Collection _ids
}
```
#### 2 Invitation Request (friend, group invitation)
```js
{
  _id: ObjectId,
  sender: ObjectId,                             // Ref: User _ids
  receiver: ObjectId,                           // Ref: User _ids
  createdAt: Date,                              // Default: Date.now()
  content: String,
  status: "pending" | "accepted" | "rejected",
}
```
#### 3 Chat (1:1 and group)
```js
{
  _id: ObjectId,
  isGroup: Boolean,
  name: String,               // For group chat
  participants: [ObjectId],   // Ref: User _ids (2 for 1:1, many for group)
  groupId: ObjectId,          // Ref: Group _id
  messages: [ObjectId],       // Ref: Message _ids
  lastMessage: ObjectId,      // Ref: Message _id
  pinnedBy: [ObjectId],       // Ref: User _ids -- who pinned this chat
  createdAt: Date,            // Default: Date.now()
  updatedAt: Date
}
```
#### 4 Group
```js
{
  _id: ObjectId,
  name: String,
  members: [ObjectId],       // User _ids
  admins: [ObjectId],        // User _ids
  invited: [ObjectId],       // User _ids (pending invitations)
  createdAt: Date,           // Default: Date.now()
  updatedAt: Date
}
```
#### 5 Message
```js
{
  _id: ObjectId,
  chatId: ObjectId,                                                       // Ref: Chat _id
  groupId: ObjectId,                                                      // Ref: Group _id -- If group message
  sender: ObjectId,                                                       // Ref: User _id
  content: String,                                                        // Text content
  type: "text" | "image" | "file" | "link" | "emoji" | "video"| "audio",
  attachments: [ObjectId],                                                // Ref: Media _id -- for image/file/link/emoji/video/audio
  starredBy: [ObjectId],                                                  // Users who starred this message
  readBy: [ObjectId],                                                     // Users who have read the message
  createdAt: Date,
  updatedAt: Date,
  deleted: Boolean
}
```
#### 6 AI Chat
```js
{
  _id: ObjectId,
  userId: ObjectId,           // Ref: User _id
  messages: [ObjectId],       // Ref: Message _ids
  pinned: true,
  createdAt: Date,
  updatedAt: Date
}
```
#### 7 Notification

```js
{
  _id: ObjectId,
  userId: ObjectId,
  type: "message" | "friend_request" | "group_invite"
  content: String,
  relatedId: ObjectId,                                  // e.g., messageId, groupId
  read: Boolean,
  createdAt: Date
}
```
#### 8 Call (for audio/video calls)

```js
{
  _id: ObjectId,
  type: "audio" | "video",
  chatId: ObjectId,                          // Ref: Chat _id
  groupId: ObjectId,                         // Ref: Group _id
  initiator: ObjectId,                       // Ref: User _id
  participants: [ObjectId],                  // Ref: User _ids
  startedAt: Date,
  endedAt: Date,
  status: "ongoing" | "ended" | "missed"
}
```

#### Media (for Attachment Metadata)
```js
{
  _id: ObjectId,
  uploader: ObjectId,                             // Ref: User _id
  chatId: ObjectId,                               // Ref: Chat _id
  groupId: ObjectId,                              // Ref: Group _id
  type: "image" | "file" | "video" | "audio",
  url: String,                                    // S3 URL
  fileType: String,
  name: String,
  size: Number,
  uploadedAt: Date
}
```
#### Collection (for lists of starred messages, lists of image|video|file)
```js
{
  _id: ObjectId,
  chatId: ObjectId,                            // Ref: Chat _id
  owner: ObjectId,                             // Ref: User _id
  starredMessages: [ObjectId],                 // Ref: Message _ids
  attachments: [ObjectId],                     // Ref: Media _ids
}
```


**Notes:**
- All media (images, files, videos, audios, documents, and avatars) are stored in AWS S3, with only the metadata and S3 URLs stored in MongoDB.
- All references are MongoDB `ObjectId` types. References (`ObjectId`) are used for relations (users, chats, messages, groups, etc).
- Timestamps (`createdAt`, `updatedAt`) are used for sorting and auditing.
- Data models can be further normalized or denormalized based on performance and scaling requirements.
- Embedded arrays (e.g., starred messages, group members) for fast access, but may be normalized if lists become very large.
- Timestamps on all models to help with sorting and querying.
- AI chat is modeled as a specific chat type or even a special chat per user.

## API Reference

## Socket.IO Events
## Installation & Setup
## Deployment
## Usage
  ### API testing instructions (e.g. via Postman)
  ### How to test chat messages
## Security Notes
* Security Headers
    * Helmet -- Sets various HTTP headers to protect against well-known web vulnerabilities (e.g., clickjacking, MIME sniffing, etc.)
* Rate Limiting & Request Control
    * express-rate-limit – Throttle repeated requests to public APIs and endpoints to prevent brute-force attacks
* Input Sanitization & XSS Protection
    * express-mongo-sanitize – Prevents NoSQL injection by removing prohibited characters in MongoDB queries
    * xss – Sanitizes user input to prevent Cross-site scripting (XSS) attacks
* Cookie Security
    * cookie-parser – Parses and verifies signed cookies
    * cookie-session – Provides secure and efficient session management
* CORS Configuration
    * cors – Configured to allow only trusted domains and control HTTP methods and headers allowed by the server
* Authentication & Authorization: 
    * JWT -- to implement stateless and secure authentication.
        * The token is then used to authenticate requests to protected routes and it was passed via authorization: Bearer <token> header (preferred)
        * Token expiration: JWTs expire after a configurable period (e.g., 1 hour).
        * Secure storage: tokens are stored in secure, HTTP-only cookies to mitigate XSS attacks.
* HTTPS usage (optional)
    * Deploy behind HTTPS (e.g., with a reverse proxy like NGINX or use AWS ALB/Cloudflare) for production

## Known Issues / Limitations
  ### Features under development
  ### Current Issues
## Acknowledgements
